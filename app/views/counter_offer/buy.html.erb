<%= render 'gameplays/nav_header' %>

<div class="nicefont">
  <h1>Buy from <%= @context.character.name %></h1>
  <h2><%= @context.character.dialogue_content %></h2>

  <div>
    <p>
      <strong>Balance:</strong>
      <%= @context.character.balance %>
    </p>

    <% unless @pref.nil? %>
      <p>
        <strong>Occupation Description:</strong>
        <%= @pref.description %>
      </p>
    <% end %>
  </div>

  <% if @context.character %>
    <%= render partial: 'sinventory2' %>

    <div style="margin-top: 20px;" class="hermitfont flex justify-center">
      <%= form_with(url: create_counter_offer_path(id: @context.character.id), method: :post, local: true) do %>
        <div class="card-display">
          <div class="mb-1">
            <%= label_tag :item_i_want_id, 'I want' %>
            <%= select_tag :item_i_want_id, options_from_collection_for_select(Item.all, :id, :name, selected: @context.character.item_to_offer_id), include_blank: true %>
          </div>

          <div>
            <%= label_tag :quantity_i_want, 'Quantity I want' %>
            <%= number_field_tag :quantity_i_want, @context.character.quantity_to_offer %>
          </div>

          <div>
            <strong>Total price: $<span id="total_price">0</span></strong>
          </div>
        </div>

        <div style="margin-bottom: 10px;" class="flex items-center justify-center py-4">
          <%= submit_tag 'Purchase', class: "green-button mx-4" %>
          <%= link_to "Back", trade_path(@context.character.id), class: "blue-button" %>
        </div>
      <% end %>
    </div>
  <% end %>

  <%# Display flash messages %>
  <% if flash[:notice] %>
    <div class="success-notice">
      <%= flash[:notice] %>
    </div>
  <% end %>

  <% if flash[:alert] %>
    <div class="error-notice">
      <%= flash[:alert] %>
    </div>
  <% end %>

  <% unless @context.character %>
    <p>Character not found.</p>
  <% end %>

</div>